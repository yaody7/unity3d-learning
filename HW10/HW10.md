# HW10

### 1. 坦克对战游戏 AI 设计

**具体要求如下**

- 使用“感知-思考-行为”模型，建模 AI 坦克
- 场景中要放置一些障碍阻挡对手视线
- 坦克需要放置一个矩阵包围盒触发器，以保证 AI 坦克能使用射线探测对手方位
- AI 坦克必须在有目标条件下使用导航，并能绕过障碍。（失去目标时策略自己思考）
- 实现人机对战



常规的**Director** 和**Controller** 就不介绍代码了，主要针对 **Robot、Wall、Bullet、Player** 的脚本进行解释。

**Robot**

> Robot主要做的是导航以及发射炮弹。使用的是射线 **Ray** 来检测前方的物体，若是碰到了墙，那么 **Robot** 停止运动，模拟机器看不到玩家的情况，当当 **Ray** 没有碰到墙，就会跟踪 **Player** 的位置。
>
> **具体代码如下：**
>
> ```c#
> using System.Collections;
> using System.Collections.Generic;
> using UnityEngine;
> 
> public class Robot : MonoBehaviour
> {
>     int count = 10000;
>     public Transform player;
>     // Start is called before the first frame update
>     void Start()
>     {
>         
>     }
> 
>     // Update is called once per frame
>     void Update()
>     {
>         player = Director.getInstance().currentController.player.transform;
>         Vector3 start = new Vector3(this.transform.position.x + 1.5f, this.transform.position.y, this.transform.position.z - 3);
>         count++;
>         Ray ray = new Ray(start, new Vector3(0,0,-1));
>         RaycastHit hit;
>         if(Physics.Raycast(ray,out hit, Mathf.Infinity))
>         {
>             if (hit.collider.name.Equals("Wall"))
>             {
>                 Debug.Log("HIT WALL");
>                 return;
>             }
>             else
>             {
>                 if (count >= 10)
>                 {
>                     count = 0;
>                     GameObject temp = Instantiate(Resources.Load("Prefabs/Bullet", typeof(GameObject)), start, Quaternion.identity, null) as GameObject;
>                     temp.GetComponent<Bullet>().speed = -3;
>                 }
>                 
>             }
>         }
>         Vector3 target = new Vector3(player.transform.position.x, this.transform.position.y, this.transform.position.z);
>         this.transform.position = Vector3.MoveTowards(this.transform.position, target, 5 * Time.deltaTime);
>     }
> }
> 
> ```



**Player**

> **Player** 实现的是跟随按键移动，并在点击坦克的时候发射子弹。
>
> **具体代码如下：**
>
> ```C#
> using System.Collections;
> using System.Collections.Generic;
> using UnityEngine;
> 
> public class Player : MonoBehaviour
> {
>     int count = 10000;
>     // Start is called before the first frame update
>     void Start()
>     {
>         
>     }
> 
>     // Update is called once per frame
>     void Update()
>     {
>         count++;
>         if (Input.GetMouseButton(0))
>         {
>             if (count > 10)
>             {
>                 count = 0;
>                 Vector3 start = new Vector3(this.transform.position.x + 1.5f, this.transform.position.y, this.transform.position.z + 3);
>                 GameObject temp = Instantiate(Resources.Load("Prefabs/Bullet", typeof(GameObject)), start, Quaternion.identity, null) as GameObject;
>                 temp.GetComponent<Bullet>().speed = 3;
>             }
>         }
>     }
>     private void OnGUI()
>     {
>         if (Input.GetKeyDown(KeyCode.A))
>         {
>             this.transform.position += new Vector3(-10 * Time.deltaTime, 0, 0);
>         }
>         if (Input.GetKeyDown(KeyCode.D))
>         {
>             this.transform.position += new Vector3(10 * Time.deltaTime, 0, 0);
>         }
>     }
>     private void OnTriggerEnter(Collider other)
>     {
>         Debug.Log("我中弹了！");
>     }
> }
> 
> ```



**Bullet**

> **Bullet** 要做的是检测碰撞，碰到物体或者移出了画面，就会自动销毁，以节省运行代价。若是碰到了 **Robot** 或是 **Player** ，就会设置对应的结束提示符。
>
> **具体代码如下：**
>
> ``` c#
>  using System.Collections;
> using System.Collections.Generic;
> using UnityEngine;
> 
> public class Bullet : MonoBehaviour
> {
>     public int speed;
>     string hint = "";
>     // Start is called before the first frame update
>     void Start()
>     {
>         
>     }
> 
>     // Update is called once per frame
>     void Update()
>     {
>         this.transform.position += new Vector3(0, 0, speed * Time.deltaTime);
>         if (this.transform.position.z < -10)
>             Destroy(this.gameObject);
>     }
> 
>     private void OnTriggerEnter(Collider other)
>     {
>         if (other.name.Equals("RobotCube"))
>         {
>             if (Director.getInstance().currentController.hint.Equals(""))
>                 Director.getInstance().currentController.hint = "You Win!";
>             //win
>         }
>         else if (other.name.Equals("PlayerCube"))
>         {
>             if (Director.getInstance().currentController.hint.Equals(""))
>                 Director.getInstance().currentController.hint = "You Lose!";
>             //lose
>         }
>         Destroy(this.gameObject);
>     }
> }
> ```



**Wall**

> **Wall** 设计的就是作用移动而已，没有什么难的地方
>
> **具体代码如下：**
>
> ```c#
> using System.Collections;
> using System.Collections.Generic;
> using UnityEngine;
> 
> public class Wall : MonoBehaviour
> {
>     int position = 0;   //0 for left, 1 for right
>     // Start is called before the first frame update
>     void Start()
>     {
>         
>     }
> 
>     // Update is called once per frame
>     void Update()
>     {
> 
>         if (position == 1)
>         {
>             this.transform.position += new Vector3(3 * Time.deltaTime, 0, 0);
>             if (this.transform.position.x > 10)
>                 position = 0;
>         }
>         if (position == 0)
>         {
>             this.transform.position += new Vector3(-3 * Time.deltaTime, 0, 0);
>             if (this.transform.position.x < -10)
>                 position = 1;
>         }
> 
>     }
> 
> }
> ```



**效果展示**

https://github.com/yaody7/unity3d-learning/blob/master/HW10/效果展示.mp4



Github：https://github.com/yaody7/unity3d-learning/tree/master/HW10




